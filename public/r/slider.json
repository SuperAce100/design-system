{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "slider",
  "type": "registry:component",
  "title": "Slider",
  "description": "A bar-wave slider with keyboard support and inline value editing.",
  "dependencies": [],
  "files": [
    {
      "path": "registry/new-york/blocks/slider/slider.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst clamp = (value: number, min: number, max: number) => Math.min(max, Math.max(min, value));\n\nconst getStepPrecision = (step: number) => {\n  if (!Number.isFinite(step)) {\n    return 0;\n  }\n\n  const stepText = step.toString();\n  if (stepText.includes(\"e-\")) {\n    const [, exponent = \"0\"] = stepText.split(\"e-\");\n    return Number.parseInt(exponent, 10) || 0;\n  }\n\n  const [, decimals = \"\"] = stepText.split(\".\");\n  return decimals.length;\n};\n\nconst trimTrailingZeros = (value: string) => value.replace(/\\.?0+$/, \"\");\n\nconst normalizeStep = (step: number | undefined) =>\n  Number.isFinite(step) && (step ?? 0) > 0 ? (step as number) : null;\n\nconst snapToStep = (value: number, min: number, max: number, step: number | null) => {\n  const normalized = clamp(value, min, max);\n  if (step === null) {\n    return normalized;\n  }\n  const nextStep = step;\n  const precision = Math.min(getStepPrecision(nextStep) + 2, 8);\n  const snapped = Math.round((normalized - min) / nextStep) * nextStep + min;\n  return Number(clamp(snapped, min, max).toFixed(precision));\n};\n\nconst getPercentFromValue = (value: number, min: number, max: number) => {\n  if (max <= min) {\n    return 0;\n  }\n  return clamp((value - min) / (max - min), 0, 1);\n};\n\nconst getRangePrecision = (range: number) => {\n  if (!Number.isFinite(range) || range <= 0) {\n    return 0;\n  }\n\n  if (range <= 5) {\n    return 2;\n  }\n\n  if (range <= 20) {\n    return 1;\n  }\n\n  return 0;\n};\n\nconst formatDisplayValue = (value: number, step: number | null, range: number) => {\n  const precision = Math.min(step === null ? getRangePrecision(range) : getStepPrecision(step), 4);\n  if (precision === 0) {\n    return `${Math.round(value)}`;\n  }\n  return trimTrailingZeros(value.toFixed(precision));\n};\n\nexport type SliderProps = Omit<React.ComponentPropsWithoutRef<\"div\">, \"defaultValue\"> & {\n  value?: number;\n  defaultValue?: number;\n  min?: number;\n  max?: number;\n  step?: number;\n  bars?: number;\n  editable?: boolean;\n  disabled?: boolean;\n  valueSuffix?: string;\n  onValueChange?: (value: number) => void;\n  onValueCommit?: (value: number) => void;\n};\n\nconst Slider = React.forwardRef<HTMLDivElement, SliderProps>(\n  (\n    {\n      className,\n      value,\n      defaultValue,\n      min = 0,\n      max = 100,\n      step,\n      bars = 36,\n      editable = true,\n      disabled = false,\n      valueSuffix = \"\",\n      onValueChange,\n      onValueCommit,\n      style,\n      onPointerDown,\n      onPointerMove,\n      onPointerUp,\n      onPointerCancel,\n      onKeyDown,\n      ...props\n    },\n    ref\n  ) => {\n    const safeStep = normalizeStep(step);\n    const safeMax = max > min ? max : min + (safeStep ?? 1);\n    const valueRange = safeMax - min;\n    const keyboardStep = safeStep ?? Math.max((safeMax - min) / 100, 0.01);\n    const isControlled = value !== undefined;\n\n    const [uncontrolledValue, setUncontrolledValue] = React.useState(() =>\n      snapToStep(defaultValue ?? min, min, safeMax, safeStep)\n    );\n    const [isEditing, setIsEditing] = React.useState(false);\n    const [draftValue, setDraftValue] = React.useState(\"\");\n    const [isDragging, setIsDragging] = React.useState(false);\n\n    const sliderRef = React.useRef<HTMLDivElement | null>(null);\n    const inputRef = React.useRef<HTMLInputElement | null>(null);\n    const pointerIdRef = React.useRef<number | null>(null);\n\n    const resolvedValue = snapToStep(\n      isControlled ? value : uncontrolledValue,\n      min,\n      safeMax,\n      safeStep\n    );\n\n    const setSliderRef = React.useCallback(\n      (node: HTMLDivElement | null) => {\n        sliderRef.current = node;\n        if (typeof ref === \"function\") {\n          ref(node);\n          return;\n        }\n        if (ref) {\n          ref.current = node;\n        }\n      },\n      [ref]\n    );\n\n    React.useEffect(() => {\n      if (!isControlled) {\n        setUncontrolledValue((previous) => snapToStep(previous, min, safeMax, safeStep));\n      }\n    }, [isControlled, min, safeMax, safeStep]);\n\n    React.useEffect(() => {\n      if (!isEditing) {\n        setDraftValue(formatDisplayValue(resolvedValue, safeStep, valueRange));\n      }\n    }, [resolvedValue, safeStep, valueRange, isEditing]);\n\n    React.useEffect(() => {\n      if (!isEditing) {\n        return;\n      }\n\n      inputRef.current?.focus();\n      inputRef.current?.select();\n    }, [isEditing]);\n\n    const setValue = React.useCallback(\n      (nextValue: number, options?: { commit?: boolean }) => {\n        const snapped = snapToStep(nextValue, min, safeMax, safeStep);\n        const hasChanged = snapped !== resolvedValue;\n\n        if (!isControlled && hasChanged) {\n          setUncontrolledValue(snapped);\n        }\n\n        if (hasChanged) {\n          onValueChange?.(snapped);\n        }\n\n        if (options?.commit) {\n          onValueCommit?.(snapped);\n        }\n      },\n      [isControlled, min, onValueChange, onValueCommit, resolvedValue, safeMax, safeStep]\n    );\n\n    const valuePercent = getPercentFromValue(resolvedValue, min, safeMax);\n    const barCount = clamp(Math.round(bars), 12, 96);\n    const labelLeftPercent = clamp(valuePercent * 100, 8, 92);\n\n    const updateFromClientX = React.useCallback(\n      (clientX: number, options?: { commit?: boolean }) => {\n        const sliderElement = sliderRef.current;\n        if (!sliderElement) {\n          return;\n        }\n\n        const rect = sliderElement.getBoundingClientRect();\n        if (rect.width <= 0) {\n          return;\n        }\n\n        const relativeX = clamp((clientX - rect.left) / rect.width, 0, 1);\n        const nextValue = min + relativeX * (safeMax - min);\n        setValue(nextValue, options);\n      },\n      [min, safeMax, setValue]\n    );\n\n    const stopDragging = React.useCallback(() => {\n      pointerIdRef.current = null;\n      setIsDragging(false);\n    }, []);\n\n    const commitDraft = React.useCallback(\n      (cancel = false) => {\n        if (cancel) {\n          setDraftValue(formatDisplayValue(resolvedValue, safeStep, valueRange));\n          setIsEditing(false);\n          return;\n        }\n\n        const parsed = Number.parseFloat(draftValue.trim());\n        if (!Number.isNaN(parsed)) {\n          setValue(parsed, { commit: true });\n        } else {\n          setDraftValue(formatDisplayValue(resolvedValue, safeStep, valueRange));\n        }\n\n        setIsEditing(false);\n      },\n      [draftValue, resolvedValue, safeStep, setValue, valueRange]\n    );\n\n    const tokenStyle: React.CSSProperties = {\n      // Token contract:\n      // --slider-bg: container background (defaults to --muted)\n      // --slider-border: container border (defaults to --border)\n      // --slider-bar: bar color (defaults to --foreground)\n      // --slider-value-fg: inline value color (defaults to --foreground)\n      \"--slider-bg\": \"var(--muted)\",\n      \"--slider-border\": \"var(--border)\",\n      \"--slider-bar\": \"var(--foreground)\",\n      \"--slider-value-fg\": \"var(--foreground)\",\n      ...style,\n    } as React.CSSProperties;\n\n    return (\n      <div\n        {...props}\n        ref={setSliderRef}\n        data-slot=\"slider\"\n        data-disabled={disabled ? \"true\" : \"false\"}\n        role=\"slider\"\n        tabIndex={disabled ? -1 : 0}\n        aria-disabled={disabled}\n        aria-valuemin={min}\n        aria-valuemax={safeMax}\n        aria-valuenow={resolvedValue}\n        aria-valuetext={\n          valueSuffix\n            ? `${formatDisplayValue(resolvedValue, safeStep, valueRange)}${valueSuffix}`\n            : formatDisplayValue(resolvedValue, safeStep, valueRange)\n        }\n        className={cn(\n          \"relative h-[108px] w-full touch-none select-none rounded-2xl border border-[var(--slider-border)] bg-[var(--slider-bg)] px-3 py-3 outline-none transition-colors\",\n          \"focus-visible:ring-2 focus-visible:ring-ring/40\",\n          \"data-[disabled=true]:cursor-not-allowed data-[disabled=true]:opacity-60\",\n          isDragging ? \"cursor-grabbing\" : \"cursor-grab\",\n          className\n        )}\n        style={tokenStyle}\n        onPointerDown={(event) => {\n          onPointerDown?.(event);\n          if (event.defaultPrevented || disabled || isEditing) {\n            return;\n          }\n\n          pointerIdRef.current = event.pointerId;\n          event.currentTarget.setPointerCapture(event.pointerId);\n          setIsDragging(true);\n          updateFromClientX(event.clientX);\n        }}\n        onPointerMove={(event) => {\n          onPointerMove?.(event);\n          if (event.defaultPrevented || pointerIdRef.current !== event.pointerId) {\n            return;\n          }\n\n          updateFromClientX(event.clientX);\n        }}\n        onPointerUp={(event) => {\n          onPointerUp?.(event);\n          if (event.defaultPrevented || pointerIdRef.current !== event.pointerId) {\n            return;\n          }\n\n          updateFromClientX(event.clientX, { commit: true });\n          if (event.currentTarget.hasPointerCapture(event.pointerId)) {\n            event.currentTarget.releasePointerCapture(event.pointerId);\n          }\n          stopDragging();\n        }}\n        onPointerCancel={(event) => {\n          onPointerCancel?.(event);\n          if (event.defaultPrevented || pointerIdRef.current !== event.pointerId) {\n            return;\n          }\n\n          if (event.currentTarget.hasPointerCapture(event.pointerId)) {\n            event.currentTarget.releasePointerCapture(event.pointerId);\n          }\n          stopDragging();\n        }}\n        onLostPointerCapture={() => {\n          stopDragging();\n        }}\n        onKeyDown={(event) => {\n          onKeyDown?.(event);\n          if (event.defaultPrevented || disabled || isEditing) {\n            return;\n          }\n\n          const stepSize = event.shiftKey ? keyboardStep * 10 : keyboardStep;\n\n          switch (event.key) {\n            case \"ArrowLeft\":\n            case \"ArrowDown\": {\n              event.preventDefault();\n              setValue(resolvedValue - stepSize, { commit: true });\n              break;\n            }\n            case \"ArrowRight\":\n            case \"ArrowUp\": {\n              event.preventDefault();\n              setValue(resolvedValue + stepSize, { commit: true });\n              break;\n            }\n            case \"PageDown\": {\n              event.preventDefault();\n              setValue(resolvedValue - keyboardStep * 10, { commit: true });\n              break;\n            }\n            case \"PageUp\": {\n              event.preventDefault();\n              setValue(resolvedValue + keyboardStep * 10, { commit: true });\n              break;\n            }\n            case \"Home\": {\n              event.preventDefault();\n              setValue(min, { commit: true });\n              break;\n            }\n            case \"End\": {\n              event.preventDefault();\n              setValue(safeMax, { commit: true });\n              break;\n            }\n            default:\n              break;\n          }\n        }}\n      >\n        <div className=\"pointer-events-none absolute inset-3 flex items-end gap-1\">\n          {Array.from({ length: barCount }, (_, index) => {\n            const ratio = barCount <= 1 ? 0 : index / (barCount - 1);\n            const distance = Math.abs(ratio - valuePercent);\n            const valleyWidth = 0.1;\n            const valley = Math.exp(-(distance * distance) / (2 * valleyWidth * valleyWidth));\n            const height = clamp(0.72 - valley * 0.56, 0.1, 0.82);\n            const opacity = clamp(1 - valley * 0.42, 0.2, 1);\n\n            return (\n              <span\n                key={`bar-${index}`}\n                className=\"flex-1 rounded-full bg-[var(--slider-bar)] transition-[height,opacity] duration-200 ease-out\"\n                style={{\n                  height: `${(height * 100).toFixed(2)}%`,\n                  opacity,\n                }}\n              />\n            );\n          })}\n        </div>\n\n        <div\n          className=\"absolute inset-3 z-10 pointer-events-none\"\n          aria-label=\"Slider value display\"\n          aria-live=\"polite\"\n        >\n          <div\n            className=\"pointer-events-auto absolute top-[34%] -translate-x-1/2 -translate-y-1/2 transition-[left] duration-200 ease-out\"\n            style={{ left: `${labelLeftPercent.toFixed(3)}%` }}\n          >\n            <div\n              className=\"flex items-baseline gap-0.5 px-1 text-[var(--slider-value-fg)] drop-shadow-[0_1px_0_var(--slider-bg)]\"\n              onPointerDown={(event) => {\n                event.stopPropagation();\n              }}\n              onClick={(event) => {\n                event.stopPropagation();\n              }}\n              onDoubleClick={(event) => {\n                event.stopPropagation();\n                if (!editable || disabled) {\n                  return;\n                }\n                setDraftValue(formatDisplayValue(resolvedValue, safeStep, valueRange));\n                setIsEditing(true);\n              }}\n            >\n              {isEditing ? (\n                <input\n                  ref={inputRef}\n                  value={draftValue}\n                  inputMode=\"decimal\"\n                  aria-label=\"Slider value\"\n                  className=\"w-12 bg-transparent text-center text-3xl leading-none font-semibold tabular-nums outline-none\"\n                  onChange={(event) => {\n                    setDraftValue(event.target.value);\n                  }}\n                  onBlur={() => {\n                    commitDraft();\n                  }}\n                  onKeyDown={(event) => {\n                    event.stopPropagation();\n                    if (event.key === \"Enter\") {\n                      event.preventDefault();\n                      commitDraft();\n                      return;\n                    }\n\n                    if (event.key === \"Escape\") {\n                      event.preventDefault();\n                      commitDraft(true);\n                    }\n                  }}\n                />\n              ) : (\n                <span className=\"text-3xl leading-none font-semibold tabular-nums\">\n                  {formatDisplayValue(resolvedValue, safeStep, valueRange)}\n                </span>\n              )}\n              {valueSuffix ? (\n                <span className=\"text-base leading-none font-medium opacity-80\">{valueSuffix}</span>\n              ) : null}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n);\n\nSlider.displayName = \"Slider\";\n\nexport { Slider };\n",
      "type": "registry:component",
      "target": "components/ui/slider.tsx"
    }
  ]
}